erDiagram
    USUARIO {
        int id PK
        string nombre
        string rol
        string firma_digital
    }

    SISTEMA {
        int id PK
        string codigo
        string nombre
        string servicio
    }

    PLANTA {
        int id PK
        string codigo UK
        int sistema_id FK
        string nombre
    }

    AREA {
        int id PK
        string nombre
        int planta_id FK
    }

    PUNTO_MUESTREO {
        int id PK
        string nombre
        string codigo
        int area_id FK
    }

    PRODUCTO {
        int id PK
        string codigo UK
        string nombre UK
        int planta_id FK
    }

    RECEPCION {
        int id PK
        string num_analisis UK
        datetime fecha
        int usuario_id FK
        int punto_muestreo_id FK
        int producto_id FK
        string estado
    }

    ANALISIS {
        int id PK
        date fecha
        int recepcion_id FK
        string tipo_analisis
        int usuario_id FK
    }

    %% RELACIONES ORGANIZATIVAS
    SISTEMA ||--|{ PLANTA : posee
    PLANTA ||--|{ AREA : divide_en
    PLANTA ||--|{ PRODUCTO : elabora
    AREA ||--o{ PUNTO_MUESTREO : contiene
    AREA ||--|{ EQUIPO : ubica

    %% RELACIONES DE PROCESO
    PUNTO_MUESTREO ||--|{ RECEPCION : origina
    PRODUCTO ||--o{ RECEPCION : requiere
    RECEPCION ||--|{ ANALISIS : genera
    USUARIO ||--|{ RECEPCION : registra
    USUARIO ||--|{ ANALISIS : ejecuta

    EQUIPO {
        int id PK
        string codigo UK
        string estado
        int area_id FK
    }

    USO_EQUIPO {
        int id PK
        date fecha
        int equipo_id FK
        int analisis_id FK
        int usuario_id FK
    }
    
    EQUIPO ||--|{ USO_EQUIPO : registra
    ANALISIS ||--|{ USO_EQUIPO : requiere

    RESULTADO {
        int id PK
        int analisis_id FK
        string resultado
        int volumen_siembra
        string dilucion
        string estado
        date fecha_salida
        int usuario_id FK
    }
    ANALISIS ||--|{ RESULTADO : tiene
    USUARIO ||--|{ RESULTADO : reporta

    %% GESTION DE MEDIOS
    MEDIO_PREPARADO {
        int id PK
        string codigo UK
        string apariencia
    }

    ORDEN_PREPARACION_MEDIO {
        int id PK
        date fecha
        int usuario_id FK
        int medio_preparado_id FK
        int volumen
        int total_frascos
    }
    
    MEDIO_PREPARADO ||--o{ ORDEN_PREPARACION_MEDIO : planifica

    POLVO_SUPLEMENTO {
        int id PK
        string codigo UK
        string lote
        date vence
        string nombre
        string almacenamiento
        string tipo
    }

    USO_POLVO_SUPLEMENTO {
        int id PK
        int polvo_suplemento_id FK
        int preparacion_medio_id FK
        float cantidad
        string unidad
    }

    POLVO_SUPLEMENTO ||--|{ USO_POLVO_SUPLEMENTO : consume
    ORDEN_PREPARACION_MEDIO ||--|{ USO_POLVO_SUPLEMENTO : incluye

    STOCK_MEDIOS {
        int id PK
        int orden_preparacion_medio_id FK
        string lote
        date vence
        string estado
    }

    ORDEN_PREPARACION_MEDIO ||--|{ STOCK_MEDIOS : produce

    APROBACION_MEDIOS {
        int id PK
        int stock_medios_id FK
        int analisis_qc_id FK
        date fecha_aprobacion
        int usuario_id FK
    }
    %% Relacion 1 a 1 (o 0 a 1)
    STOCK_MEDIOS ||--o| APROBACION_MEDIOS : valida

    USO_MEDIOS {
        int id PK
        int analisis_id FK
        int stock_medios_id FK
        int num_frasco
        int cantidad
        string unidad
    }

    STOCK_MEDIOS ||--|{ USO_MEDIOS : utiliza
    ANALISIS ||--|{ USO_MEDIOS : consume

    %% AUDITORIA
    REVISION {
        int id PK
        string tabla
        int identificador_registro
        int usuario_id FK
        string conclusion
    }
    USUARIO ||--|{ REVISION : audita